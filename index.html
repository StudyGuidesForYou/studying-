<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aurora — Web OS</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Interact.js -->
<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
<!-- xterm.js -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />
<script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>

<style>
:root{
  --bg1: linear-gradient(135deg,#0f172a 0%, #021025 60%, #052b36 100%);
  --glass: rgba(255,255,255,0.06);
  --accent: #7c5cff;
  --accent2: #00e5ff;
  --radius: 14px;
}
html,body,#root{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overflow:hidden;background:var(--bg1);}
#wallpaper{position:fixed;inset:0;background-position:center;background-size:cover;filter:blur(0.3px) saturate(1.05);}
#desktop{position:absolute;inset:0;padding:24px;display:flex;flex-wrap:wrap;gap:18px;align-content:flex-start;}
.desk-icon{width:84px;text-align:center;color:white;cursor:pointer;user-select:none}
.desk-icon img{width:64px;height:64px;border-radius:12px;box-shadow:0 4px 20px rgba(2,6,23,0.6);}
.desk-icon span{display:block;margin-top:6px;font-size:13px;max-width:84px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* Taskbar */
#taskbar{position:fixed;left:0;right:0;bottom:0;height:56px;padding:6px 18px;display:flex;align-items:center;gap:12px;background:linear-gradient(180deg, rgba(8,10,15,0.18), rgba(8,10,15,0.28));backdrop-filter: blur(8px);border-top:1px solid rgba(255,255,255,0.03);}
#start-button{width:44px;height:44px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;color:white;font-weight:600;cursor:pointer;box-shadow:0 6px 22px rgba(2,6,23,0.6);}
#taskbar .pinned {display:flex;gap:8px;align-items:center}
.tb-btn{height:40px;min-width:40px;padding:6px;border-radius:9px;background:transparent;border:none;cursor:pointer;color:white;display:flex;align-items:center;justify-content:center}
.tb-btn:hover{background:rgba(255,255,255,0.03)}

/* Windows */
.aurora-window{position:absolute;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 20px 50px rgba(2,6,23,0.7);overflow:hidden;border:1px solid rgba(255,255,255,0.03);transition:transform 0.15s;}
.win-title{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);backdrop-filter: blur(3px);cursor:move}
.win-title .left{display:flex;gap:8px;align-items:center}
.win-controls button{margin-left:6px;border-radius:8px;width:32px;height:28px;background:transparent;border:0;color:white;cursor:pointer}
.win-body{height:calc(100% - 44px);background:transparent;overflow:auto;padding:4px}

/* Start Menu */
#start-menu{position:fixed;left:50%;transform:translateX(-50%);bottom:72px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));border-radius:16px;padding:14px;width:760px;box-shadow:0 30px 70px rgba(2,6,23,0.7);display:flex;gap:14px;color:white}
.start-left{width:46%}
.start-right{width:54%;display:flex;flex-direction:column;gap:8px}
.app-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.app-card{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;cursor:pointer}
.app-card:hover{background:rgba(255,255,255,0.02)}

/* Context menu */
.ctx{position:fixed;background:#0b1220;color:white;border-radius:8px;padding:8px;box-shadow:0 10px 30px rgba(2,6,23,0.6);display:none;z-index:9999}
.ctx button{display:block;width:100%;text-align:left;padding:6px;border-radius:6px;background:transparent;border:0;color:white;cursor:pointer}

/* Helpers */
.muted{color:rgba(255,255,255,0.6);font-size:13px}
.icon-small{width:22px;height:22px;border-radius:6px}
</style>
</head>
<body>
<div id="wallpaper" style="background-image: radial-gradient(circle at 10% 20%, rgba(124,92,255,0.18), transparent 10%), radial-gradient(circle at 80% 80%, rgba(0,229,255,0.06), transparent 10%), linear-gradient(135deg,#021025 0%, #052b36 100%);"></div>
<div id="desktop" oncontextmenu="return false;"></div>

<div id="start-menu" style="display:none" aria-hidden="true">
  <div class="start-left">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px">
      <div style="width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700">A</div>
      <div>
        <div style="font-weight:700;font-size:16px">Aurora</div>
        <div class="muted">Welcome back — ready to explore?</div>
      </div>
    </div>
    <div style="margin-top:8px" class="muted">Pinned</div>
    <div id="pinned-grid" class="app-grid" style="margin-top:8px"></div>
  </div>
  <div class="start-right">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:700">All apps</div>
      <input id="start-search" placeholder="Search apps..." style="background:rgba(255,255,255,0.03);border-radius:8px;padding:8px;border:0;color:white;width:55%" />
    </div>
    <div id="all-apps" style="overflow:auto;height:420px;margin-top:8px"></div>
  </div>
</div>

<div id="taskbar">
  <div id="start-button" title="Start (press Win or click)">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path d="M3 3h4v4H3V3zM9 3h6v4H9V3zM15 3h6v4h-6V3zM3 9h4v6H3V9zM9 9h6v6H9V9zM15 9h6v6h-6V9zM3 15h4v6H3v-6zM9 15h6v6H9v-6zM15 15h6v6h-6v-6z" fill="white"/>
    </svg>
  </div>
  <div class="pinned" id="taskbar-pinned"></div>
  <div style="flex:1"></div>
  <div style="display:flex;gap:10px;align-items:center;color:white">
    <div id="tray-wifi" class="muted">Aurora</div>
    <div id="tray-time" class="muted"></div>
    <div id="tray-open-menu" style="width:40px;height:40px;border-radius:8px;background:transparent;display:flex;align-items:center;justify-content:center;cursor:pointer">⚙️</div>
  </div>
</div>

<div id="ctx-menu" class="ctx" role="menu">
  <button onclick="createNewFile()">New text file</button>
  <button onclick="refreshDesktop()">Refresh</button>
  <button onclick="openSettings()">Change wallpaper</button>
</div>

<div id="windows-root"></div>

<script>
// ---------- Apps ----------
const APPS=[
  {id:'notepad',name:'Notepad'},
  {id:'calculator',name:'Calculator'},
  {id:'paint',name:'Paint'},
  {id:'terminal',name:'Terminal'},
  {id:'files',name:'Files'},
  {id:'settings',name:'Settings'},
  {id:'photos',name:'Photos'},
  {id:'music',name:'Music'},
  {id:'browser',name:'Browser'},
  {id:'calendar',name:'Calendar'},
  {id:'clock',name:'Clock'},
  {id:'sticky',name:'Sticky Notes'},
  {id:'maps',name:'Maps'},
  {id:'weather',name:'Weather'},
  {id:'tips',name:'Tips'},
  {id:'todo',name:'To-Do List'},
  {id:'pomodoro',name:'Pomodoro Timer'},
  {id:'games',name:'Game Launcher'}
];

const state={
  windows:[], z:100, pinned:JSON.parse(localStorage.getItem('aurora_pinned')||'[]'),
  wallpaper:localStorage.getItem('aurora_wallpaper')||'', dark:true,
  files:JSON.parse(localStorage.getItem('aurora_files')||'[]')
};

const desktop=document.getElementById('desktop');
const windowsRoot=document.getElementById('windows-root');
const startMenu=document.getElementById('start-menu');
const pinnedGrid=document.getElementById('pinned-grid');
const allAppsEl=document.getElementById('all-apps');
const taskbarPinned=document.getElementById('taskbar-pinned');
const trayTime=document.getElementById('tray-time');
const ctxMenu=document.getElementById('ctx-menu');
const wallpaperEl=document.getElementById('wallpaper');
const startSearch=document.getElementById('start-search');

// ---------- Utilities ----------
function findApp(id){return APPS.find(a=>a.id===id||a.name===id);}

// ---------- Desktop ----------
function renderDesktop(){
  desktop.innerHTML='';
  APPS.forEach(app=>{
    const el=document.createElement('div'); el.className='desk-icon'; el.title=app.name;
    el.innerHTML=`<img src="" alt="${app.name}" style="background:rgba(255,255,255,0.1);border-radius:12px;width:64px;height:64px"/><span>${app.name}</span>`;
    el.ondblclick=()=>openAppWindow(app);
    el.onclick=()=>selectIcon(el);
    desktop.appendChild(el);
  });
}
function selectIcon(el){
  document.querySelectorAll('.desk-icon').forEach(d=>d.style.outline='none');
  el.style.outline='2px solid rgba(255,255,255,0.06)';
  setTimeout(()=>el.style.outline='none',1200);
}

// ---------- Start Menu ----------
function renderStartMenu(){
  pinnedGrid.innerHTML=''; state.pinned.forEach(id=>{
    const app=findApp(id); if(!app) return;
    const card=document.createElement('div'); card.className='app-card'; card.innerText=app.name; card.onclick=()=>openAppWindow(app);
    pinnedGrid.appendChild(card);
  });
  allAppsEl.innerHTML=''; APPS.forEach(app=>{
    const row=document.createElement('div'); row.className='app-card'; row.innerText=app.name; row.onclick=()=>openAppWindow(app);
    allAppsEl.appendChild(row);
  });
}
function toggleStart(){startMenu.style.display==='none'?startMenu.style.display='flex':startMenu.style.display='none';}

// ---------- Window Management ----------
function focusWindow(id){
  const el=document.getElementById(id); if(el){el.style.zIndex=++state.z; throttleWindow(el);}
}
function throttleWindow(el){
  if(el.dataset.throttle) return; el.dataset.throttle=true;
  requestAnimationFrame(()=>{el.dataset.throttle=false;});
}

function openAppWindow(app){
  if(!app) return; const id='win-'+app.id;
  let existing=document.getElementById(id); if(existing){existing.style.display='block'; focusWindow(id); return;}
  const win=document.createElement('div'); win.id=id; win.className='aurora-window';
  win.style.left='100px'; win.style.top='100px'; win.style.width='480px'; win.style.height='320px'; win.style.zIndex=++state.z;
  win.innerHTML=`<div class="win-title"><div class="left">${app.name}</div><div class="win-controls">
    <button onclick="minimizeWindow('${id}')">_</button>
    <button onclick="toggleMaximize('${id}')">□</button>
    <button onclick="closeWindow('${id}')">×</button></div></div>
    <div class="win-body">${app.name==='Terminal'?'<div id="term-'+id+'" style="width:100%;height:100%"></div>':'<p style="padding:12px;">Welcome to '+app.name+'</p>'}</div>`;
  windowsRoot.appendChild(win);

  if(app.name==='Terminal'){
    const term=new Terminal({cols:80,rows:24}); term.open(document.getElementById('term-'+id)); term.writeln('Aurora Terminal Ready');
  }

  interact(win).draggable({allowFrom:'.win-title', listeners:{move(e){const t=e.target; t.style.left=(parseFloat(t.style.left)||0)+e.dx+'px'; t.style.top=(parseFloat(t.style.top)||0)+e.dy+'px';}}})
  .resizable({edges:{left:true,right:true,top:true,bottom:true},modifiers:[interact.modifiers.restrictSize({min:{width:320,height:160}})],listeners:{move(e){const t=e.target; t.style.width=e.rect.width+'px'; t.style.height=e.rect.height+'px'; t.style.left=(parseFloat(t.style.left)||0)+e.deltaRect.left+'px'; t.style.top=(parseFloat(t.style.top)||0)+e.deltaRect.top+'px';}}});

  state.windows.push({id:id,title:app.name});
  updateTaskbar(); reportAuroraState();
}

// ---------- Window Actions ----------
function closeWindow(id){const el=document.getElementById(id); if(el) el.remove(); state.windows=state.windows.filter(w=>w.id!==id); updateTaskbar(); reportAuroraState();}
function minimizeWindow(id){const el=document.getElementById(id); if(el) el.style.display='none'; updateTaskbar(); reportAuroraState();}
function toggleMaximize(id){const el=document.getElementById(id); if(!el) return;
  if(el.dataset.max==='1'){el.style.left=el.dataset.ox; el.style.top=el.dataset.oy; el.style.width=el.dataset.ow; el.style.height=el.dataset.oh; el.dataset.max='0';}
  else{el.dataset.ox=el.style.left; el.dataset.oy=el.style.top; el.dataset.ow=el.style.width; el.dataset.oh=el.style.height;
    el.style.left='6px'; el.style.top='6px'; el.style.width=(window.innerWidth-12)+'px'; el.style.height=(window.innerHeight-92)+'px'; el.dataset.max='1';} reportAuroraState();
}

// ---------- Taskbar ----------
function updateTaskbar(){
  taskbarPinned.innerHTML=''; state.pinned.forEach(id=>{
    const app=findApp(id); if(!app) return; const btn=document.createElement('button'); btn.className='tb-btn'; btn.innerText=app.name; btn.onclick=()=>openAppWindow(app); taskbarPinned.appendChild(btn);
  });
}

// ---------- Context Menu ----------
document.addEventListener('contextmenu', (e)=>{if(e.target.closest('.desk-icon')||e.target.closest('.aurora-window')){ctxMenu.style.display='none';return;} e.preventDefault(); ctxMenu.style.left=e.clientX+'px'; ctxMenu.style.top=e.clientY+'px'; ctxMenu.style.display='block';});
document.addEventListener('click', ()=>ctxMenu.style.display='none');

// ---------- Files ----------
window.createNewFile=function(){state.files.push({name:'new-file-'+Date.now()+'.txt',content:''}); renderFiles();}
window.refreshDesktop=function(){renderDesktop();}
window.openSettings=function(){openAppWindow(findApp('settings'));}
function renderFiles(){}

// ---------- Clock ----------
setInterval(()=>{trayTime.innerText=new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})},1000);

// ---------- State Reporter ----------
function reportAuroraState(){
  console.group('%cAurora Web OS State', 'color:#7c5cff;font-weight:bold;font-size:16px');
  console.log('%cWindows:', 'color:#00e5ff;font-weight:bold', state.windows.map(w=>{const el=document.getElementById(w.id);return{id:w.id,title:w.title,minimized:el?el.style.display==='none':true,maximized:el?el.dataset.max==='1':false,z:el?el.style.zIndex:null,pos:el?{left:el.style.left,top:el.style.top}:null,size:el?{width:el.style.width,height:el.style.height}:null};}));
  console.log('%cPinned:', 'color:#00e5ff;font-weight:bold', state.pinned);
  console.log('%cFiles:', 'color:#00e5ff;font-weight:bold', state.files);
  console.log('%cZ-Index:', 'color:#00e5ff;font-weight:bold', state.z);
  console.groupEnd();
}

// ---------- Init ----------
if(!state.pinned.length) state.pinned=['notepad','terminal'];
renderDesktop();
renderStartMenu();
document.getElementById('start-button').onclick=toggleStart;
startSearch.oninput=()=>{const q=startSearch.value.toLowerCase(); Array.from(allAppsEl.children).forEach(row=>{row.style.display=!q?'flex':row.innerText.toLowerCase().includes(q)?'flex':'none';});};
document.addEventListener('click', (e)=>{const w=e.target.closest('.aurora-window'); if(w) focusWindow(w.id);});
</script>

</body>
</html>
